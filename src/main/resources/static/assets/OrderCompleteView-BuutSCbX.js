import{j as E,r as i,o as A,b as d,d as t,l as $,t as a,F as b,g as k,n as C,i as n,m as v,u as F}from"./index-D7EuPnGH.js";import{r as O,f as R,g as x}from"./firebaseConfig-Cr89vwH1.js";const U={class:"order-complete"},V={class:"order-info"},B={class:"order-header"},L={class:"order-number-container"},M={class:"order-number-wrapper"},j={class:"order-number"},T={key:0,class:"product-info"},H={class:"product-list"},z={class:"product-details-wrapper"},G=["src"],J={class:"product-description"},K={class:"product-brand-name"},Q={class:"product-name"},W={key:0,class:"product-rental-dates"},X={key:1},Y={class:"product-variant"},Z={key:2,class:"product-variant"},tt={class:"product-price"},st={key:0},ot={class:"item-price"},et={class:"price-amount"},rt={key:1},at={class:"item-price"},dt={class:"price-amount"},nt={key:1},lt={class:"shipping-info"},it={class:"shipping-table"},ct={class:"shipping-cell"},ut={class:"shipping-data"},pt={class:"span shipping-value"},vt={class:"payment-info"},_t={class:"payment-body"},ht={class:"payment-row"},yt={class:"payment-data"},ft={class:"span payment-value"},mt={class:"final-payment-border"},gt={class:"final-payment-data"},It={class:"span final-payment-amount"},St={__name:"OrderCompleteView",setup(Dt){var I;(I=E().user)==null||I.userId;const _=C(),h=F(),p=i(""),c=i([]),y=i({}),f=i("카드"),m=i(0);i(0);const w=async()=>{const r=_.query.orderId;if(!r){alert("주문 정보가 없습니다.");return}console.log("Order ID from query:",r),p.value=r;try{const o=await fetch(`http://localhost:8081/api/order/orderComplete?orderId=${p.value}`);if(!o.ok)throw new Error("네트워크 응답에 문제가 있습니다.");const s=await o.json();if(p.value=s.orderId,f.value="카드",m.value=s.totalAmount,s.orderDetails&&Array.isArray(s.orderDetails)){c.value=s.orderDetails.map(e=>{let l=e.productPrice;if(e.codiId){const D=g(e.rentalStartDate,e.rentalEndDate),q=(D>3?D-3:0)*1e4;l=e.productPrice+q}else e.quantity>1&&(l=e.productPrice*e.quantity);return{orderItemId:e.orderItemId,productId:e.productId,codiId:e.codiId,productName:e.productName,brandName:e.brandName,quantity:e.quantity,rentalStartDate:e.rentalStartDate,rentalEndDate:e.rentalEndDate,productPrice:e.productPrice,totalPrice:l,type:e.codiId?"codi":"product"}});for(let e=0;e<c.value.length;e++)await P(c.value[e])}y.value={주소:s.orderAddress,"받는 사람":s.orderAddressee,휴대폰번호:s.orderPhone,"배송 메모":s.orderComment}}catch(o){console.error("주문 정보를 불러오는 데 실패했습니다:",o),alert("주문 정보를 불러오는 데 실패했습니다.")}},u=r=>r?r.toLocaleString():"0",P=async r=>{let o;r.productId?o=`lookkit/products/0${r.productId}/${r.productId}_thumbnail.webp`:r.codiId&&(o=`lookkit/codi/0${r.codiId}/${r.codiId}_thumbnail.webp`),console.log("이미지 경로 확인:",o);try{const s=O(R,o),e=await x(s);r.thumbnailUrl=e}catch(s){console.error(`이미지 가져오기 실패: ${o}`,s),r.thumbnailUrl=null}},g=(r,o)=>{if(!r||!o)return 0;const s=new Date(r),l=new Date(o)-s;return Math.ceil(l/(1e3*60*60*24))},S=()=>{h.push("/mypage/manage")},N=()=>{h.push("/main")};return A(()=>{console.log("Order ID from route:",_.query.orderId),w()}),(r,o)=>(n(),d("div",U,[t("div",V,[t("div",B,[o[3]||(o[3]=t("div",{class:"heading"},[t("div",{class:"order-complete-text"},"주문이 완료되었습니다")],-1)),t("div",L,[t("div",M,[t("div",j,[o[0]||(o[0]=$("주문번호: ")),t("span",null,a(p.value),1)])])]),t("div",{class:"order-links"},[t("button",{class:"button view-order-link",onClick:S},o[1]||(o[1]=[t("span",null,"구매내역 보기",-1)])),t("button",{class:"button home-link",onClick:N},o[2]||(o[2]=[t("span",null,"쇼핑 홈 가기",-1)]))])]),c.value.length>0?(n(),d("div",T,[o[4]||(o[4]=t("div",{class:"product-header"},[t("div",{class:"product-title"},"상품 정보")],-1)),t("div",H,[(n(!0),d(b,null,k(c.value,s=>(n(),d("div",{key:s.orderItemId,class:"product-item"},[t("div",z,[t("img",{class:"product-image",src:s.thumbnailUrl||"/images/placeholder.png",alt:"상품 이미지"},null,8,G),t("div",J,[t("div",K,a(s.brandName),1),t("div",Q,a(s.productName),1),s.rentalStartDate&&s.rentalEndDate?(n(),d("div",W," 대여일 "+a(s.rentalStartDate)+" ~ 반납일 "+a(s.rentalEndDate),1)):v("",!0),s.type==="product"?(n(),d("div",X,[t("div",Y,a(s.quantity)+"개",1)])):s.type==="codi"?(n(),d("div",Z," 대여 기간 "+a(g(s.rentalStartDate,s.rentalEndDate))+"일 ",1)):v("",!0)]),t("div",tt,[s.type==="product"?(n(),d("div",st,[t("div",ot,a(u(s.productPrice))+"원",1),t("div",et,a(u(s.totalPrice))+"원",1)])):s.type==="codi"?(n(),d("div",rt,[t("div",at,a(u(s.productPrice))+"원",1),t("div",dt,a(u(s.totalPrice))+"원",1)])):v("",!0)])])]))),128))])])):(n(),d("div",nt,o[5]||(o[5]=[t("p",null,"주문한 상품 정보가 없습니다.",-1)]))),t("div",lt,[o[6]||(o[6]=t("div",{class:"shipping-header"},[t("div",{class:"shipping-info-title"},"배송지 정보")],-1)),t("div",it,[(n(!0),d(b,null,k(y.value,(s,e,l)=>(n(),d("div",{class:"shipping-row",key:l},[t("div",ct,a(e),1),t("div",ut,[t("span",pt,a(s),1)])]))),128))])]),t("div",vt,[o[8]||(o[8]=t("div",{class:"payment-header"},[t("div",{class:"payment-info-title"},"결제 정보")],-1)),t("div",_t,[t("div",ht,[o[7]||(o[7]=t("div",{class:"payment-cell"},"결제수단",-1)),t("div",yt,[t("span",ft,a(f.value),1)])])]),o[9]||(o[9]=t("div",{class:"final-payment-header"},[t("div",{class:"final-payment-title"},"최종 결제금액")],-1)),t("div",mt,[t("div",gt,[t("span",It,a(u(m.value))+" 원",1)])])])])]))}};export{St as default};
