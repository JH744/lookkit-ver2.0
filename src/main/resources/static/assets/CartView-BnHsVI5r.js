import{j as z,r as S,c as h,b as l,d as t,z as B,p as O,m as _,F as f,g as C,t as n,a as g,i as r,v as y,A as R,l as V,x as N,H as j,u as J}from"./index-BL_Zk_BC.js";import{r as Z,f as H,g as W}from"./firebaseConfig-Cr89vwH1.js";import{u as G}from"./orderStore-Bjkf2d3u.js";const K="data:image/svg+xml,%3csvg%20width='19'%20height='21'%20viewBox='0%200%2019%2021'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20clip-path='url(%23clip0_104_1788)'%3e%3cpath%20d='M0.25%2010.5C0.25%209.23266%200.496798%208.01868%200.990395%206.85806C1.48399%205.69744%202.15101%204.70358%202.99146%203.87647C3.83191%203.04937%204.83244%202.38234%205.99306%201.87541C7.15368%201.36847%208.36766%201.12167%209.635%201.13501C10.9023%201.14835%2012.1163%201.39515%2013.2769%201.87541C14.4376%202.35566%2015.4314%203.02268%2016.2585%203.87647C17.0856%204.73026%2017.7527%205.72412%2018.2596%206.85806C18.7665%207.992%2019.0133%209.20598%2019%2010.5C18.9867%2011.794%2018.7399%2013.008%2018.2596%2014.1419C17.7793%2015.2759%2017.1123%2016.2764%2016.2585%2017.1435C15.4047%2018.0107%2014.4109%2018.6777%2013.2769%2019.1446C12.143%2019.6115%2010.929%2019.8583%209.635%2019.885C8.34098%2019.9117%207.127%2019.6649%205.99306%2019.1446C4.85912%2018.6243%203.85859%2017.9573%202.99146%2017.1435C2.12433%2016.3298%201.45731%2015.3292%200.990395%2014.1419C0.523479%2012.9546%200.276681%2011.7407%200.25%2010.5ZM3.79189%2011.1203C3.79189%2011.4138%203.89194%2011.6673%204.09205%2011.8807L7.15368%2014.9424C7.34045%2015.1425%207.58725%2015.2425%207.89408%2015.2425C8.20091%2015.2425%208.45438%2015.1425%208.65448%2014.9424L14.9578%208.63901C15.1713%208.42557%2015.278%208.1721%2015.278%207.87861C15.278%207.58512%2015.1713%207.33832%2014.9578%207.13821C14.7444%206.93811%2014.4909%206.83805%2014.1974%206.83805C13.9039%206.83805%2013.6572%206.93811%2013.457%207.13821L7.91409%2012.7012L5.59285%2010.3799C5.39274%2010.1798%205.14594%2010.0798%204.85245%2010.0798C4.55896%2010.0798%204.30883%2010.1832%204.10205%2010.3899C3.89528%2010.5967%203.79189%2010.8402%203.79189%2011.1203Z'%20fill='%23062236'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='clip0_104_1788'%3e%3crect%20width='18.75'%20height='21'%20fill='white'%20transform='matrix(1%200%200%20-1%200.25%2021)'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",X={class:"cart-container"},Y={class:"tab-section"},tt={class:"cart-header"},et={class:"cart-actions"},st=["src"],ot={key:0,class:"cart-item-list"},at={key:0},nt=["data-cart-id"],lt={class:"item-checkbox"},rt=["onUpdate:modelValue"],ct={class:"item-thumbnail"},dt=["href"],it=["src"],ut={class:"item-description"},pt={class:"product-name"},vt={class:"item-description"},ht={class:"product-variant"},_t=["onUpdate:modelValue","onChange"],gt=["onUpdate:modelValue","onChange"],yt={class:"item-price-box"},mt={class:"item-price"},It=["onClick"],ft={key:1,class:"cart-item-list2"},Ct={key:0},bt=["data-cart-id"],kt={class:"item-checkbox"},St=["onUpdate:modelValue"],Dt={class:"item-thumbnail"},Ut=["href"],$t=["src"],Pt={class:"item-description"},wt={class:"brand"},At={class:"product-name"},Et={class:"item-description"},xt={class:"product-variant"},Lt=["onUpdate:modelValue","onChange"],qt=["value"],Bt={class:"item-price-box"},Rt={class:"item-price"},Vt=["onClick"],Nt={class:"selected-items-section"},Tt={key:0},Ft={class:"item-thumbnail"},Mt=["href"],Qt=["src"],zt={class:"item-description"},Ot={class:"product-name"},jt={class:"item-description"},Jt={class:"item-description"},Zt={key:0,class:"product-variant"},Ht={key:1,class:"product-variant"},Wt={class:"item-price-box"},Gt={class:"item-price"},Kt={class:"cart-summary"},Xt={class:"summary-details"},Yt={class:"summary-item"},te={class:"summary-item"},ee={class:"summary-item"},se={class:"summary-item"},oe={class:"checkout-button-container"},de={__name:"CartView",setup(ae){var L;const D=z(),U=D.token,p=(L=D.user)==null?void 0:L.userId;console.log("JWT Token:",U),console.log("User ID from AuthStore:",p);const u=S("coordinate"),d=S([]),i=S([]),m=G(),$=async e=>{let s;e.codiId?s=`lookkit/codi/0${e.codiId}/${e.codiId}_thumbnail.webp`:e.productId&&(s=`lookkit/products/0${e.productId}/${e.productId}_thumbnail.webp`),console.log("이미지 경로 확인:",s);try{const o=Z(H,s),a=await W(o);e.thumbnailUrl=a}catch(o){console.error(`이미지 가져오기 실패: ${s}`,o),e.thumbnailUrl=null}};(async()=>{try{console.log("Fetching cart items for user ID:",p);const s=await g.get(`/api/cart/items?userId=${p}`,{headers:{Authorization:`Bearer ${U}`}});console.log("Fetched cart items response:",s.data);const o=s.data;for(const a of o)a.codiId?(a.type="coordinate",await $(a),d.value.push({...a,selected:!0})):a.productId&&(a.type="single",await $(a),i.value.push({...a,selected:!0}))}catch(e){console.error("장바구니 데이터를 불러오는 데 실패했습니다.",e)}})();const b=e=>e.productPrice*(e.quantity||1),k=e=>{if(e.rentalStartDate&&e.rentalEndDate){const s=new Date(e.rentalStartDate),a=new Date(e.rentalEndDate)-s,q=Math.ceil(a/(1e3*60*60*24));return q>3?e.codiPrice+(q-3)*1e4:e.codiPrice}return e.codiPrice},T=async()=>{const e=c.value;if(e.length===0){alert("선택된 항목이 없습니다.");return}try{await g.post("http://localhost:8081/api/cart/delete/bulk",{cartIds:e.map(o=>o.cartId)}),d.value=d.value.filter(o=>!o.selected),i.value=i.value.filter(o=>!o.selected)}catch(s){alert("선택된 상품을 삭제하는 데 실패했습니다."),console.error("Error deleting selected items:",s)}},P=async e=>{try{await g.post("http://localhost:8081/api/cart/delete",{cartId:e.cartId}),e.type==="coordinate"?d.value=d.value.filter(o=>o.cartId!==e.cartId):i.value=i.value.filter(o=>o.cartId!==e.cartId)}catch(s){alert("아이템을 삭제하는 데 실패했습니다."),console.error("Error deleting item:",s)}},c=h(()=>{const e=[...d.value,...i.value].filter(s=>s.selected);return console.log("Selected items in cart.vue:",e),e}),w=h(()=>c.value.filter(e=>e.type==="coordinate").reduce((e,s)=>e+(s.quantity||1),0)),A=h(()=>c.value.filter(e=>e.type==="single").reduce((e,s)=>e+(s.quantity||1),0)),E=h(()=>w.value+A.value),I=h(()=>c.value.reduce((e,s)=>s.type==="coordinate"?e+k(s):e+b(s),0)),v=e=>e?e.toLocaleString():"0",F=async e=>{if(e.quantity<=0){alert("수량은 1 이상이어야 합니다."),e.quantity=1;return}try{await g.post(`http://localhost:8081/api/cart/update?userId=${p}`,{cartId:e.cartId,quantity:e.quantity})}catch(s){alert("수량을 변경하는 데 실패했습니다."),console.error("Error updating quantity:",s)}},x=async(e,s)=>{try{await g.post(`http://localhost:8081/api/cart/update?userId=${p}`,{cartId:e.cartId,rentalStartDate:s==="start"?e.rentalStartDate:void 0,rentalEndDate:s==="end"?e.rentalEndDate:void 0})}catch(o){alert("대여일을 변경하는 데 실패했습니다."),console.error("Error updating rental date:",o)}},M=J(),Q=async()=>{if(c.value.length===0){alert("선택된 상품이 없습니다.");return}m.$patch({selectedItems:c.value.map(e=>({itemId:e.productId||e.codiId,itemName:e.productName||e.codiDescription,brandName:e.brandName||"",type:e.type,quantity:e.quantity||1,startDate:e.rentalStartDate||null,endDate:e.rentalEndDate||null,totalPrice:e.productPrice||e.codiPrice})),totalFinalPrice:I.value}),m.setSelectedItems(c.value,I.value),localStorage.setItem("orderStore",JSON.stringify(m.selectedItems)),console.log("Order Store before navigating to order page:",m.selectedItems),M.push("/order")};return(e,s)=>(r(),l("div",X,[s[16]||(s[16]=t("div",{class:"cart-title"},[t("h2",null,"옷장")],-1)),t("div",Y,[t("div",{class:B({active:u.value==="coordinate"}),onClick:s[0]||(s[0]=o=>u.value="coordinate")}," 코디상품 ",2),t("div",{class:B({active:u.value==="single"}),onClick:s[1]||(s[1]=o=>u.value="single")}," 단일상품 ",2)]),t("div",tt,[s[3]||(s[3]=t("h3",null,"상품 정보",-1)),t("div",et,[t("button",{class:"select-delete-button",onClick:T},[t("img",{class:"icon-delete",src:O(K),alt:"삭제"},null,8,st),s[2]||(s[2]=t("span",null,"선택삭제",-1))])])]),u.value==="coordinate"?(r(),l("div",ot,[d.value.length===0?(r(),l("div",at,s[4]||(s[4]=[t("p",null,"코디상품이 없습니다.",-1)]))):_("",!0),(r(!0),l(f,null,C(d.value,o=>(r(),l("div",{key:o.cartId,class:"cart-item","data-cart-id":o.cartId},[t("div",lt,[y(t("input",{type:"checkbox","onUpdate:modelValue":a=>o.selected=a,class:"checkbox-input"},null,8,rt),[[R,o.selected]])]),t("div",ct,[t("a",{href:`/codi/${o.codiId}`},[t("img",{class:"thumbnail-img",src:o.thumbnailUrl||"/images/placeholder.png",alt:"코디 이미지"},null,8,it)],8,dt)]),t("div",ut,[t("div",pt,n(o.codiDescription),1)]),t("div",vt,[t("div",ht,[s[5]||(s[5]=V(" 대여일 ")),y(t("input",{type:"date","onUpdate:modelValue":a=>o.rentalStartDate=a,onChange:a=>x(o,"start")},null,40,_t),[[N,o.rentalStartDate]]),s[6]||(s[6]=V(" ~ 반납일 ")),y(t("input",{type:"date","onUpdate:modelValue":a=>o.rentalEndDate=a,onChange:a=>x(o,"end")},null,40,gt),[[N,o.rentalEndDate]])])]),t("div",yt,[t("div",mt,[t("strong",null,n(v(k(o)))+"원",1)])]),t("button",{class:"delete-button",onClick:a=>P(o)},s[7]||(s[7]=[t("span",null,"삭제",-1)]),8,It)],8,nt))),128))])):_("",!0),u.value==="single"?(r(),l("div",ft,[i.value.length===0?(r(),l("div",Ct,s[8]||(s[8]=[t("p",null,"단일상품이 없습니다.",-1)]))):_("",!0),(r(!0),l(f,null,C(i.value,o=>(r(),l("div",{key:o.cartId,class:"cart-item","data-cart-id":o.cartId},[t("div",kt,[y(t("input",{type:"checkbox","onUpdate:modelValue":a=>o.selected=a,class:"checkbox-input"},null,8,St),[[R,o.selected]])]),t("div",Dt,[t("a",{href:`/product/${o.productId}`},[t("img",{class:"thumbnail-img",src:o.thumbnailUrl||"/images/placeholder.png",alt:"썸네일"},null,8,$t)],8,Ut)]),t("div",Pt,[t("div",wt,n(o.brandName),1),t("div",At,n(o.productName),1)]),t("div",Et,[t("div",xt,[y(t("select",{"onUpdate:modelValue":a=>o.quantity=a,onChange:a=>F(o),id:"quantity",class:"quantity-input"},[(r(),l(f,null,C(10,a=>t("option",{key:a,value:a-1},n(a-1),9,qt)),64))],40,Lt),[[j,o.quantity,void 0,{number:!0}]])])]),t("div",Bt,[t("div",Rt,[t("strong",null,n(v(b(o)))+"원",1)])]),t("button",{class:"delete-button",onClick:a=>P(o)},s[9]||(s[9]=[t("span",null,"삭제",-1)]),8,Vt)],8,bt))),128))])):_("",!0),s[17]||(s[17]=t("div",{class:"cart-header"},[t("h3",null,"선택된 상품")],-1)),t("div",Nt,[c.value.length===0?(r(),l("div",Tt,s[10]||(s[10]=[t("p",null,"선택된 상품이 없습니다.",-1)]))):(r(!0),l(f,{key:1},C(c.value,o=>(r(),l("div",{key:o.cartId,class:"cart-item selected-item"},[t("div",Ft,[t("a",{href:o.productId?`/product/${o.productId}`:`/codi/${o.codiId}`},[t("img",{class:"thumbnail-img",src:o.thumbnailUrl||"/images/placeholder.png",alt:"상품 이미지"},null,8,Qt)],8,Mt)]),t("div",zt,[t("div",Ot,n(o.productName||o.codiDescription),1)]),t("div",jt,[t("div",Jt,[o.type==="single"?(r(),l("div",Zt,[t("span",null,n(o.quantity)+"개",1)])):o.type==="coordinate"?(r(),l("div",Ht," 대여일: "+n(o.rentalStartDate)+" ~ 반납일: "+n(o.rentalEndDate),1)):_("",!0)]),t("div",Wt,[t("div",Gt,[t("strong",null,n(v(o.type==="coordinate"?k(o):b(o)))+"원",1)])])])]))),128))]),t("div",Kt,[s[15]||(s[15]=t("div",{class:"summary-header"},[t("h3",null,"최종 결제 예상 금액")],-1)),t("div",Xt,[t("div",Yt,[s[11]||(s[11]=t("span",null,"대여코디 개수",-1)),t("strong",null,n(w.value)+"개",1)]),t("div",te,[s[12]||(s[12]=t("span",null,"구매상품 개수",-1)),t("strong",null,n(A.value)+"개",1)]),t("div",ee,[s[13]||(s[13]=t("span",null,"총 개수",-1)),t("strong",null,n(E.value)+"개",1)]),t("div",se,[s[14]||(s[14]=t("span",null,"총 금액",-1)),t("strong",null,n(v(I.value))+"원",1)])]),t("div",oe,[t("button",{class:"checkout-button",onClick:Q},[t("span",null,"총 "+n(E.value)+"개 / "+n(v(I.value))+"원 주문하기",1)])])])]))}};export{de as default};
