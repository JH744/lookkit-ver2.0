import{j as $,r as i,o as A,b as d,d as t,l as C,t as a,F as b,g as k,n as R,i as n,m as v,u as F}from"./index-sYiAQ8_U.js";import{r as O,f as U,g as x}from"./firebaseConfig-Cr89vwH1.js";const L={class:"order-complete"},V={class:"order-info"},B={class:"order-header"},M={class:"order-number-container"},j={class:"order-number-wrapper"},T={class:"order-number"},H={key:0,class:"product-info"},z={class:"product-list"},G={class:"product-details-wrapper"},J=["src"],K={class:"product-description"},Q={class:"product-brand-name"},W={class:"product-name"},X={key:0,class:"product-rental-dates"},Y={key:1},Z={class:"product-variant"},tt={key:2,class:"product-variant"},st={class:"product-price"},ot={key:0},et={class:"item-price"},rt={class:"price-amount"},at={key:1},dt={class:"item-price"},nt={class:"price-amount"},lt={key:1},it={class:"shipping-info"},ct={class:"shipping-table"},ut={class:"shipping-cell"},pt={class:"shipping-data"},vt={class:"span shipping-value"},_t={class:"payment-info"},ht={class:"payment-body"},yt={class:"payment-row"},ft={class:"payment-data"},mt={class:"span payment-value"},gt={class:"final-payment-border"},It={class:"final-payment-data"},Dt={class:"span final-payment-amount"},Nt={__name:"OrderCompleteView",setup(bt){var I;(I=$().user)==null||I.userId;const _=R(),h=F(),p=i(""),c=i([]),y=i({}),f=i("카드"),m=i(0);i(0);const w="http://localhost:8081",P=async()=>{const r=_.query.orderId;if(!r){alert("주문 정보가 없습니다.");return}console.log("Order ID from query:",r),p.value=r;try{const o=await fetch(`${w}/api/order/orderComplete?orderId=${p.value}`);if(!o.ok)throw new Error("네트워크 응답에 문제가 있습니다.");const s=await o.json();if(p.value=s.orderId,f.value="카드",m.value=s.totalAmount,s.orderDetails&&Array.isArray(s.orderDetails)){c.value=s.orderDetails.map(e=>{let l=e.productPrice;if(e.codiId){const D=g(e.rentalStartDate,e.rentalEndDate),E=(D>3?D-3:0)*1e4;l=e.productPrice+E}else e.quantity>1&&(l=e.productPrice*e.quantity);return{orderItemId:e.orderItemId,productId:e.productId,codiId:e.codiId,productName:e.productName,brandName:e.brandName,quantity:e.quantity,rentalStartDate:e.rentalStartDate,rentalEndDate:e.rentalEndDate,productPrice:e.productPrice,totalPrice:l,type:e.codiId?"codi":"product"}});for(let e=0;e<c.value.length;e++)await S(c.value[e])}y.value={주소:s.orderAddress,"받는 사람":s.orderAddressee,휴대폰번호:s.orderPhone,"배송 메모":s.orderComment}}catch(o){console.error("주문 정보를 불러오는 데 실패했습니다:",o),alert("주문 정보를 불러오는 데 실패했습니다.")}},u=r=>r?r.toLocaleString():"0",S=async r=>{let o;r.productId?o=`lookkit/products/0${r.productId}/${r.productId}_thumbnail.webp`:r.codiId&&(o=`lookkit/codi/0${r.codiId}/${r.codiId}_thumbnail.webp`),console.log("이미지 경로 확인:",o);try{const s=O(U,o),e=await x(s);r.thumbnailUrl=e}catch(s){console.error(`이미지 가져오기 실패: ${o}`,s),r.thumbnailUrl=null}},g=(r,o)=>{if(!r||!o)return 0;const s=new Date(r),l=new Date(o)-s;return Math.ceil(l/(1e3*60*60*24))},N=()=>{h.push("/mypage/manage")},q=()=>{h.push("/main")};return A(()=>{console.log("Order ID from route:",_.query.orderId),P()}),(r,o)=>(n(),d("div",L,[t("div",V,[t("div",B,[o[3]||(o[3]=t("div",{class:"heading"},[t("div",{class:"order-complete-text"},"주문이 완료되었습니다")],-1)),t("div",M,[t("div",j,[t("div",T,[o[0]||(o[0]=C(" 주문번호: ")),t("span",null,a(p.value),1)])])]),t("div",{class:"order-links"},[t("button",{class:"button view-order-link",onClick:N},o[1]||(o[1]=[t("span",null,"구매내역 보기",-1)])),t("button",{class:"button home-link",onClick:q},o[2]||(o[2]=[t("span",null,"쇼핑 홈 가기",-1)]))])]),c.value.length>0?(n(),d("div",H,[o[4]||(o[4]=t("div",{class:"product-header"},[t("div",{class:"product-title"},"상품 정보")],-1)),t("div",z,[(n(!0),d(b,null,k(c.value,s=>(n(),d("div",{key:s.orderItemId,class:"product-item"},[t("div",G,[t("img",{class:"product-image",src:s.thumbnailUrl||"/images/placeholder.png",alt:"상품 이미지"},null,8,J),t("div",K,[t("div",Q,a(s.brandName),1),t("div",W,a(s.productName),1),s.rentalStartDate&&s.rentalEndDate?(n(),d("div",X," 대여일 "+a(s.rentalStartDate)+" ~ 반납일 "+a(s.rentalEndDate),1)):v("",!0),s.type==="product"?(n(),d("div",Y,[t("div",Z,a(s.quantity)+"개",1)])):s.type==="codi"?(n(),d("div",tt," 대여 기간 "+a(g(s.rentalStartDate,s.rentalEndDate))+"일 ",1)):v("",!0)]),t("div",st,[s.type==="product"?(n(),d("div",ot,[t("div",et,a(u(s.productPrice))+"원 ",1),t("div",rt,a(u(s.totalPrice))+"원 ",1)])):s.type==="codi"?(n(),d("div",at,[t("div",dt,a(u(s.productPrice))+"원 ",1),t("div",nt,a(u(s.totalPrice))+"원 ",1)])):v("",!0)])])]))),128))])])):(n(),d("div",lt,o[5]||(o[5]=[t("p",null,"주문한 상품 정보가 없습니다.",-1)]))),t("div",it,[o[6]||(o[6]=t("div",{class:"shipping-header"},[t("div",{class:"shipping-info-title"},"배송지 정보")],-1)),t("div",ct,[(n(!0),d(b,null,k(y.value,(s,e,l)=>(n(),d("div",{class:"shipping-row",key:l},[t("div",ut,a(e),1),t("div",pt,[t("span",vt,a(s),1)])]))),128))])]),t("div",_t,[o[8]||(o[8]=t("div",{class:"payment-header"},[t("div",{class:"payment-info-title"},"결제 정보")],-1)),t("div",ht,[t("div",yt,[o[7]||(o[7]=t("div",{class:"payment-cell"},"결제수단",-1)),t("div",ft,[t("span",mt,a(f.value),1)])])]),o[9]||(o[9]=t("div",{class:"final-payment-header"},[t("div",{class:"final-payment-title"},"최종 결제금액")],-1)),t("div",gt,[t("div",It,[t("span",Dt,a(u(m.value))+" 원",1)])])])])]))}};export{Nt as default};
