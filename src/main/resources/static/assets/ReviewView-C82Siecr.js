import{_ as V,r as c,o as C,a as I,c as w,b as n,d as e,U as F,t as d,v as y,H as L,e as M,x as T,m,F as B,g as N,i as r}from"./index-DXYtudQ_.js";const $={class:"review-container"},z={class:"review-section"},E={class:"average-rating"},H={class:"star-ratings"},K={class:"add-review"},O={key:0,class:"expanded-review-form"},j={class:"rating-section"},q={class:"image-upload-section"},G={key:0,class:"image-preview"},J=["src"],Q={class:"review-section2"},W={key:0,class:"review-list"},X={class:"review-header"},Y={class:"review-rating"},Z={key:0,class:"review-image"},ee=["src"],te={class:"review-text"},ae={class:"review-info"},se={class:"review-date"},oe={class:"review-user"},ie={class:"pagination"},le=["disabled"],ne=["disabled"],re={key:1},f=5,de={__name:"ReviewView",props:{codiId:{type:String,default:null},productId:{type:String,default:null}},setup(k){const o=c([]),v=c(5),p=c(""),g=c(!1),i=c(1),u=c(null),l=k,x=a=>{const t=a.target.files[0];if(t){const s=new FileReader;s.onload=P=>{u.value=P.target.result},s.readAsDataURL(t)}};C(async()=>{try{console.log("props.codiId:",l.codiId),console.log("props.productId:",l.productId);let a="";if(l.codiId?a=`/api/reviews/codi/${l.codiId}`:l.productId&&(a=`/api/reviews/product/${l.productId}`),console.log("API 요청 URL:",a),a){const t=await I.get(a);console.log("리뷰 데이터:",t.data),o.value=Array.isArray(t.data)?t.data:[],console.log("리뷰 데이터:",o.value)}}catch(a){console.error("리뷰 데이터를 불러오는데 실패했습니다:",a)}});const h=()=>{g.value=!g.value},b=w(()=>!Array.isArray(o.value)||o.value.length===0?0:(o.value.reduce((t,s)=>t+s.rating,0)/o.value.length).toFixed(1)),R=w(()=>{const a=(i.value-1)*f,t=a+f;return o.value.slice(a,t)}),_=w(()=>Math.ceil(o.value.length/f)),S=()=>{i.value>1&&i.value--},U=()=>{i.value<_.value&&i.value++},A=async()=>{try{const t={productId:l.productId,codiId:l.codiId,userId:1,rating:v.value,reviewText:p.value,imageUrl:u.value};(await I.post("/api/reviews/write",t)).status===201?(alert("리뷰 작성 완료"),o.value.push({...t,createdAt:new Date().toISOString(),reviewId:o.value.length+1}),h()):alert("리뷰 작성 실패")}catch(a){console.error("리뷰 작성 오류:",a),alert("리뷰 작성에 실패했습니다.")}},D=a=>{const t={year:"numeric",month:"2-digit",day:"2-digit"};return new Date(a).toLocaleDateString("ko-KR",t)};return(a,t)=>(r(),n("div",$,[e("div",z,[e("div",E,[e("div",H,[e("div",{class:"star-ratings-fill",style:F({width:`${b.value/5*100}%`})},null,4)]),e("h3",null,"평균 평점 "+d(b.value)+" / 5",1)]),e("div",K,[e("button",{class:"add-review-button",onClick:h}," 리뷰 작성하기 "),g.value?(r(),n("div",O,[e("div",j,[t[3]||(t[3]=e("label",null,"평점:",-1)),y(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>v.value=s)},t[2]||(t[2]=[M('<option value="1" data-v-b38bf35e>1</option><option value="2" data-v-b38bf35e>2</option><option value="3" data-v-b38bf35e>3</option><option value="4" data-v-b38bf35e>4</option><option value="5" data-v-b38bf35e>5</option>',5)]),512),[[L,v.value]])]),y(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=s=>p.value=s),placeholder:"리뷰를 작성해주세요"},null,512),[[T,p.value]]),e("div",q,[t[4]||(t[4]=e("label",{for:"image-upload",class:"image-upload-label"},"이미지 업로드:",-1)),e("input",{type:"file",id:"image-upload",onChange:x,accept:"image/*"},null,32),u.value?(r(),n("div",G,[e("img",{src:u.value,alt:"업로드된 이미지 미리보기"},null,8,J)])):m("",!0)]),e("button",{type:"button",class:"submit-review",onClick:A}," 리뷰 제출하기 ")])):m("",!0)])]),e("div",Q,[o.value&&o.value.length?(r(),n("div",W,[(r(!0),n(B,null,N(R.value,s=>(r(),n("div",{key:s.reviewId,class:"review-item"},[e("div",X,[e("span",Y,d(s.rating)+"점",1),s.imageUrl?(r(),n("div",Z,[e("img",{src:s.imageUrl,alt:"리뷰 이미지"},null,8,ee)])):m("",!0)]),e("div",te,[e("p",null,d(s.reviewText),1)]),e("div",ae,[e("span",se,d(D(s.createdAt)),1),e("span",oe,d(s.userId),1)])]))),128)),e("div",ie,[e("button",{onClick:S,disabled:i.value===1}," 이전 ",8,le),e("span",null,d(i.value)+" / "+d(_.value),1),e("button",{onClick:U,disabled:i.value===_.value}," 다음 ",8,ne)])])):(r(),n("div",re,t[5]||(t[5]=[e("p",null,"작성된 리뷰가 없습니다.",-1)])))])]))}},ue=V(de,[["__scopeId","data-v-b38bf35e"]]);export{ue as default};
