import{_ as L,r as u,i,b as r,d as e,v as h,x as A,m as b,C as H,j as W,o as q,M as J,K as Z,c as T,q as K,F as C,g as B,p as _,t as l,Y as X,n as ee,l as te,A as se,u as ae}from"./index-D656lRRA.js";import{u as oe}from"./orderStore-B-QQ9sY7.js";import{r as le,f as ne,g as de}from"./firebaseConfig-Cr89vwH1.js";const ie="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFsAAAAsCAYAAAAKEcTgAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAFUSURBVHgB7dlPSsNAGAXwlz8bXepW6MZ7eJBCUhA8ggvBmm4EVz2DyVLwHF7DtQdQbE1800aIGxGZzHyt7wePSYcSyMf0SzMBRERERERERET+rwQG1HV9niTJNQ9PmBQedV33ytzneX43nU6fEZHXC/uLvtAVDydMhu0C8BY6TNP0om3bApHliO/YhcVYlGVZwbOmaa44VDx/hsiir+yxsYWsOaxhwN4X2xILbWSDvXXC/n0G/05h5DotFXvGYYY9pjYSkIodkIodkIodkJkb5FgPNfyHc9k/oUanlR2Qih2Qih2Qih2QmRvkbw1ueAeD6RduOC04f8TjG2y3ajdzMGQXV/aKeWe6r9AbR5ePPsM5M3ZuZRdFseSw/OErt8MP7pcAIywU263UFd+mzLnRP8dIeP4OkUVvI1mWPXJ4YFp4fiXWx/WUJxeIiIiIiIiIiHz3CRzaYly2dPS9AAAAAElFTkSuQmCC",re={key:0,class:"modal-overlay"},ce={class:"modal-content"},ue={class:"info-block"},pe={class:"info-block"},ve={class:"info-block"},me={class:"address-block"},ye={__name:"AddAddressView",emits:["addressRegistered","close"],setup(Y,{emit:S}){const v=S,V=u(!0),N=u(""),c=u(""),o=u(""),I=u(""),g=u(""),P=()=>{V.value=!1,v("close")},M=()=>{new window.daum.Postcode({oncomplete:function(k){let n=k.userSelectedType==="R"?k.roadAddress:k.jibunAddress;I.value=n}}).open()},x=()=>{if(!N.value||!c.value||!o.value||!I.value||!g.value){alert("모든 필드를 입력해주세요.");return}const k=`${I.value} ${g.value}`;v("addressRegistered",{addressName:N.value,recipientName:c.value,phoneNumber:o.value,fullAddress:k}),P()};return(k,n)=>V.value?(i(),r("div",re,[e("div",ce,[e("div",{class:"delete-button"},[e("button",{type:"button",class:"x-button",onClick:P},"X")]),n[9]||(n[9]=e("div",{class:"info-header"},[e("span",{class:"info-title"},"신규 배송지 등록")],-1)),e("div",ue,[n[5]||(n[5]=e("span",null,"배송지명",-1)),h(e("input",{type:"text","onUpdate:modelValue":n[0]||(n[0]=m=>N.value=m),class:"span-text",placeholder:"배송지명 입력"},null,512),[[A,N.value]])]),e("div",pe,[n[6]||(n[6]=e("span",null,"받는 사람",-1)),h(e("input",{type:"text","onUpdate:modelValue":n[1]||(n[1]=m=>c.value=m),class:"span-text",placeholder:"받는 사람 입력"},null,512),[[A,c.value]])]),e("div",ve,[n[7]||(n[7]=e("span",null,"휴대폰 번호",-1)),h(e("input",{type:"text","onUpdate:modelValue":n[2]||(n[2]=m=>o.value=m),class:"span-text",placeholder:"휴대폰 번호 입력"},null,512),[[A,o.value]])]),e("div",{class:"search-address"},[n[8]||(n[8]=e("div",{class:"label-address"},[e("span",null,"주소")],-1)),e("div",{class:"button-zipcode",onClick:M},"우편번호 찾기 ")]),e("div",me,[h(e("input",{type:"text","onUpdate:modelValue":n[3]||(n[3]=m=>I.value=m),class:"span-text",placeholder:"우편번호 입력"},null,512),[[A,I.value]]),h(e("input",{type:"text","onUpdate:modelValue":n[4]||(n[4]=m=>g.value=m),class:"span-text",placeholder:"상세 주소 입력"},null,512),[[A,g.value]])]),e("div",{class:"button-block"},[e("div",{class:"button-register",onClick:x},"등록하기")])])])):b("",!0)}},he=L(ye,[["__scopeId","data-v-a9fa43c0"]]),fe={class:"order-container"},_e={class:"recipient-info-section"},be={class:"info-table"},Ae={class:"info-row"},ke={class:"info-row"},De={class:"info-row"},Ie={class:"info-row"},ge={class:"info-row"},we={class:"info-row2"},Ne={class:"info-data"},xe={class:"memo-list"},Pe=["value"],Me={class:"memo-text"},Ue={class:"product-info-section"},Ce={key:0},Se=["src"],Ve={class:"item-description2"},Re={key:0,class:"brand-name"},Ee={key:1,class:"product-name"},$e={key:2,class:"product-name"},qe={key:0,class:"product-variant"},Te={key:1,class:"product-variant"},Be={class:"rental-period"},Fe={class:"price"},Qe={class:"item-price"},Xe={key:0,class:"adjusted-price"},Ye={key:1},je={key:0},Oe={class:"item-description"},ze=["src"],Ge={class:"item-description2"},Le={class:"brand-name"},He={class:"product-name"},We={class:"product-variant"},Je={class:"price"},Ze={class:"item-price"},Ke={class:"adjusted-price"},et={key:1},tt={class:"item-description"},st=["src"],at={class:"product-name"},ot={class:"product-variant"},lt={class:"product-variant2"},nt={class:"price"},dt={class:"item-price"},it={class:"adjusted-price"},rt={class:"payment-frame"},ct={class:"payment-method-list"},ut={class:"payment-method-item"},pt={class:"summary-row"},vt={class:"summary-value"},mt={class:"total-payment-section"},yt={class:"agreement-list"},ht=["onUpdate:modelValue"],ft={class:"agreement-text"},_t={key:0,class:"modal"},bt={class:"modal-content"},At={class:"modal-actions"},gt={__name:"OrderView",setup(Y){var Q;const S="http://localhost:8081",v=H(),N=(Q=W().user)==null?void 0:Q.userId,c=oe(),o=u(null),I=ee(),g=async s=>{let t;s.type==="codi"?t=`lookkit/codi/0${s.itemId}/${s.itemId}_thumbnail.webp`:s.type==="product"&&(t=`lookkit/products/0${s.itemId}/${s.itemId}_thumbnail.webp`),console.log("이미지 경로 확인:",t);try{const a=le(ne,t),p=await de(a);s.thumbnailUrl=p,s===o.value&&(o.value.thumbnailUrl=p)}catch(a){console.error(`이미지 가져오기 실패: ${t}`,a),s.thumbnailUrl="/images/placeholder.png"}};q(async()=>{const s=I.query;s.itemId&&(o.value={itemId:s.itemId,itemName:s.itemName,brandName:s.brandName,quantity:parseInt(s.quantity,10)||1,startDate:s.startDate,endDate:s.endDate,price:parseInt(s.price,10),totalPrice:parseInt(s.totalPrice,10),type:s.itemType||"product"},await g(o.value));for(const t of c.selectedItems)await g(t)});const P=s=>{if(s.type==="product")return s.totalPrice*(s.quantity||1);if(s.type==="codi"){const t=M(s.startDate,s.endDate),a=s.totalPrice,f=(t>3?t-3:0)*1e4;return a+f}return s.totalPrice},M=(s,t)=>{if(!s||!t)return 0;const a=new Date(s),f=new Date(t)-a,w=Math.ceil(f/(1e3*60*60*24));return w>0?w:0};u(""),u(""),u(""),u("");const x=u("선택 안 함"),k=["선택 안 함","부재 시 경비실에 맡겨주세요","부재 시 집 앞에 놔주세요","부재 시 핸드폰으로 연락 바랍니다","배송 전 연락 바랍니다"],n=u(""),m=u([{text:"주문상품정보 및 서비스 이용약관에 동의",checked:!1},{text:"구매조건 확인 및 결제 진행 동의(필수)",checked:!1},{text:"개인정보 제 3자 제공 동의(필수)",checked:!1},{text:"위 주문 내용을 확인하였으며, 결제에 모두 동의합니다",checked:!1}]);q(async()=>{await J(),console.log("Selected items in orderStore after mount:",c.selectedItems)}),Z(()=>{99/c.clearSelectedItems(),localStorage.removeItem("orderStore")});const j=T(()=>o.value?o.value.quantity||1:c.selectedItems.reduce((s,t)=>s+(t.quantity||1),0)),R=T(()=>{if(o.value&&o.value.type==="codi"&&o.value.startDate&&o.value.endDate){const s=new Date(o.value.startDate),t=new Date(o.value.endDate);return Math.ceil((t-s)/(1e3*60*60*24))}return c.selectedItems.reduce((s,t)=>{if(t.type==="codi"&&t.startDate&&t.endDate){const a=new Date(t.startDate),p=new Date(t.endDate);return s+Math.ceil((p-a)/(1e3*60*60*24))}return s},0)}),U=T(()=>{if(o.value){if(o.value.type==="product")return o.value.quantity*o.value.price;if(o.value.type==="codi"){const t=(R.value>3?R.value-3:0)*1e4;return o.value.price+t}}return c.totalFinalPrice||0}),D=s=>s?s.toLocaleString():"0";q(()=>{const s=document.createElement("script");s.src="https://cdn.iamport.kr/js/iamport.payment-1.2.0.js",s.async=!0,s.onload=()=>{console.log("Iamport script loaded successfully");const t=window.IMP;t&&t.init("imp40354073")},document.body.appendChild(s)});const F=ae(),O=()=>{if(!n.value){alert("결제 수단을 선택해주세요.");return}if(m.value.some(w=>!w.checked)){alert("모든 필수 동의 항목에 체크해주세요.");return}if(!y.value){alert("배송지를 등록해주세요.");return}const s=window.IMP;s.init("imp40354073");const t=c.selectedItems.length>0?c.selectedItems[0].itemName:"주문 상품",a=y.value.recipientName,p=y.value.phoneNumber,f=y.value.fullAddress;s.request_pay({pg:"kcp",pay_method:"card",merchant_uid:"merchant_"+new Date().getTime(),name:t,amount:U.value,buyer_name:a,buyer_tel:p,buyer_addr:f},function(w){if(w.success){v.showModal("결제 완료","결제가 완료되었습니다.","","확인",()=>{v.closeModal()});let $=[];c.selectedItems.length>0&&($=c.selectedItems.map(d=>({productId:d.type==="product"?d.itemId:null,codiId:d.type==="codi"?d.itemId:null,quantity:d.type==="product"?d.quantity:1,rentalStartDate:d.type==="codi"?d.startDate:null,rentalEndDate:d.type==="codi"?d.endDate:null,productPrice:d.totalPrice}))),o.value&&$.push({productId:o.value.type==="product"?o.value.itemId:null,codiId:o.value.type==="codi"?o.value.itemId:null,quantity:o.value.type==="product"?o.value.quantity:1,rentalStartDate:o.value.type==="codi"?o.value.startDate:null,rentalEndDate:o.value.type==="codi"?o.value.endDate:null,productPrice:o.value.totalPrice});const G={userId:N,totalAmount:U.value,orderAddress:f,orderAddressee:a,orderPhone:p,orderComment:x.value,orderStatus:"결제완료",orderDetails:$};fetch(S+"/api/order/complete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(G)}).then(d=>d.json()).then(d=>{if(!d){alert("주문 ID를 받지 못했습니다. 문제가 발생했습니다.");return}console.log("주문 완료 페이지로 이동, orderId:",d),F?F.push({path:"/order/orderComplete",query:{orderId:d}}):console.error("Router 객체가 정의되지 않았습니다.")}).catch(d=>{console.error("결제 실패 또는 서버 문제:",d),alert("결제를 완료하는 데 실패했습니다.")})}else v.showModal("결제 실패",`결제에 실패했습니다. 실패사유: ${w.error_msg}`,"","확인",v.closeModal)})},E=u(!1),y=u({addressName:"",recipientName:"",phoneNumber:"",fullAddress:""}),z=s=>{y.value=s};return(s,t)=>(i(),r(C,null,[e("div",fe,[t[23]||(t[23]=e("div",{class:"order-title"},[e("h2",null,"결제/주문")],-1)),e("section",_e,[t[16]||(t[16]=e("header",{class:"section-header"},[e("h2",{class:"section-title"},"받는 분 정보")],-1)),e("div",be,[e("div",Ae,[t[10]||(t[10]=e("span",{class:"label-title"},"배송지 정보",-1)),e("button",{class:"link-text",onClick:t[0]||(t[0]=a=>E.value=!0)}," 배송지 등록하기 "),E.value?(i(),K(he,{key:0,onClose:t[1]||(t[1]=a=>E.value=!1),onAddressRegistered:z})):b("",!0)]),e("div",ke,[t[11]||(t[11]=e("div",{class:"info-label"},"배송지명",-1)),h(e("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=a=>y.value.addressName=a),class:"input-field",readonly:""},null,512),[[A,y.value.addressName]])]),e("div",De,[t[12]||(t[12]=e("div",{class:"info-label"},"받는 사람",-1)),h(e("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=a=>y.value.recipientName=a),class:"input-field",readonly:""},null,512),[[A,y.value.recipientName]])]),e("div",Ie,[t[13]||(t[13]=e("div",{class:"info-label"},"휴대폰 번호",-1)),h(e("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=a=>y.value.phoneNumber=a),class:"input-field",readonly:""},null,512),[[A,y.value.phoneNumber]])]),e("div",ge,[t[14]||(t[14]=e("div",{class:"info-label"},"주소",-1)),h(e("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=a=>y.value.fullAddress=a),class:"input-field",readonly:""},null,512),[[A,y.value.fullAddress]])])]),e("div",we,[t[15]||(t[15]=e("div",{class:"info-label"},"배송 메모",-1)),e("div",Ne,[e("div",xe,[(i(),r(C,null,B(k,(a,p)=>e("label",{class:"memo-item",key:p},[h(e("input",{type:"radio",name:"memo-option",class:"memo-checkbox",value:a,"onUpdate:modelValue":t[6]||(t[6]=f=>x.value=f)},null,8,Pe),[[X,x.value]]),e("span",Me,l(a),1)])),64))])])])]),e("section",Ue,[t[17]||(t[17]=e("header",{class:"section-header"},[e("h2",{class:"section-title"},"상품 정보")],-1)),_(c).selectedItems.length>0?(i(),r("div",Ce,[(i(!0),r(C,null,B(_(c).selectedItems,a=>(i(),r("div",{key:a.itemId,class:"item-description"},[e("img",{class:"item-thumbnail",src:a.thumbnailUrl||"/images/placeholder.png",alt:"썸네일"},null,8,Se),e("div",Ve,[a.type==="product"&&a.brandName?(i(),r("div",Re,l(a.brandName),1)):b("",!0),a.type==="product"?(i(),r("div",Ee,l(a.itemName),1)):a.type==="codi"?(i(),r("div",$e,l(a.itemName),1)):b("",!0)]),a.type==="product"?(i(),r("div",qe,l(a.quantity)+"개 ",1)):a.type==="codi"?(i(),r("div",Te,[te(" 대여일 "+l(a.startDate)+" ~ 반납일 "+l(a.endDate)+" ",1),e("div",Be," 대여기간 "+l(M(a.startDate,a.endDate))+"일 ",1)])):b("",!0),e("div",Fe,[e("div",Qe,l(D(a.totalPrice))+"원",1),a.type==="product"||a.type==="codi"?(i(),r("div",Xe,l(D(P(a)))+"원 ",1)):b("",!0)])]))),128))])):o.value?(i(),r("div",Ye,[o.value.type==="product"?(i(),r("div",je,[e("div",Oe,[e("img",{class:"item-thumbnail",src:o.value.thumbnailUrl||"/images/placeholder.png",alt:"썸네일"},null,8,ze),e("div",Ge,[e("div",Le,l(o.value.brandName),1),e("div",He,l(o.value.itemName),1)]),e("div",We,l(o.value.quantity)+"개",1),e("div",Je,[e("div",Ze,l(D(o.value.price))+"원",1),e("div",Ke,l(D(o.value.totalPrice))+"원 ",1)])])])):o.value.type==="codi"?(i(),r("div",et,[e("div",tt,[e("img",{class:"item-thumbnail",src:o.value.thumbnailUrl||"/images/placeholder.png",alt:"썸네일"},null,8,st),e("div",at,l(o.value.itemName),1),e("div",ot," 대여일 "+l(o.value.startDate)+" ~반납일 "+l(o.value.endDate),1),e("div",lt,"대여기간 "+l(R.value)+"일",1),e("div",nt,[e("div",dt,l(D(o.value.price))+"원",1),e("div",it,l(D(o.value.totalPrice))+"원 ",1)])])])):b("",!0)])):b("",!0)]),e("section",rt,[t[21]||(t[21]=e("header",{class:"section-header2"},[e("h2",{class:"section-title"},"결제수단 선택")],-1)),e("div",ct,[e("label",ut,[h(e("input",{type:"radio",name:"payment-method",value:"card","onUpdate:modelValue":t[7]||(t[7]=a=>n.value=a)},null,512),[[X,n.value]]),t[18]||(t[18]=e("img",{src:ie,alt:"Credit/Debit Card",class:"method-icon"},null,-1)),t[19]||(t[19]=e("span",{class:"method-title"},"신용/체크카드",-1))])]),t[22]||(t[22]=e("header",{class:"section-header2"},[e("h2",{class:"section-title"},"최종 결제금액")],-1)),e("div",pt,[t[20]||(t[20]=e("span",{class:"summary-title"},"최종 결제금액",-1)),e("span",vt,l(D(U.value))+"원",1)])]),e("section",mt,[e("div",yt,[(i(!0),r(C,null,B(m.value,(a,p)=>(i(),r("label",{class:"agreement-item",key:p},[h(e("input",{type:"checkbox","onUpdate:modelValue":f=>m.value[p].checked=f},null,8,ht),[[se,m.value[p].checked]]),e("span",ft,l(a.text),1)]))),128))])]),e("button",{class:"pay-button",onClick:O}," 총 "+l(j.value)+"개 / "+l(D(U.value))+"원 결제하기 ",1)]),_(v).isModalVisible?(i(),r("div",_t,[e("div",bt,[e("h3",null,l(_(v).modalActionMessage),1),e("p",null,l(_(v).questionMessage),1),e("div",At,[e("button",{onClick:t[8]||(t[8]=(...a)=>_(v).confirmCallback&&_(v).confirmCallback(...a))},"확인"),e("button",{onClick:t[9]||(t[9]=(...a)=>_(v).closeModal&&_(v).closeModal(...a))},"취소")])])])):b("",!0)],64))}};export{gt as default};
