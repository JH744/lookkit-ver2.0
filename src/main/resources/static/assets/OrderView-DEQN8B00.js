import{_ as G,r as c,i as r,b as i,d as e,v as y,x as k,m as A,C as H,j as L,o as q,M as W,K as J,c as T,q as Z,F as C,g as B,p as b,t as n,Y as X,n as K,l as ee,A as te,u as se}from"./index-D7EuPnGH.js";import{u as ae}from"./orderStore-DAMFkfOt.js";import{r as oe,f as le,g as ne}from"./firebaseConfig-Cr89vwH1.js";const de="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFsAAAAsCAYAAAAKEcTgAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAFUSURBVHgB7dlPSsNAGAXwlz8bXepW6MZ7eJBCUhA8ggvBmm4EVz2DyVLwHF7DtQdQbE1800aIGxGZzHyt7wePSYcSyMf0SzMBRERERERERET+rwQG1HV9niTJNQ9PmBQedV33ytzneX43nU6fEZHXC/uLvtAVDydMhu0C8BY6TNP0om3bApHliO/YhcVYlGVZwbOmaa44VDx/hsiir+yxsYWsOaxhwN4X2xILbWSDvXXC/n0G/05h5DotFXvGYYY9pjYSkIodkIodkIodkJkb5FgPNfyHc9k/oUanlR2Qih2Qih2Qih2QmRvkbw1ueAeD6RduOC04f8TjG2y3ajdzMGQXV/aKeWe6r9AbR5ePPsM5M3ZuZRdFseSw/OErt8MP7pcAIywU263UFd+mzLnRP8dIeP4OkUVvI1mWPXJ4YFp4fiXWx/WUJxeIiIiIiIiIiHz3CRzaYly2dPS9AAAAAElFTkSuQmCC",re={key:0,class:"modal-overlay"},ie={class:"modal-content"},ue={class:"info-block"},ce={class:"info-block"},pe={class:"info-block"},ve={class:"address-block"},me={__name:"AddAddressView",emits:["addressRegistered","close"],setup(Y,{emit:v}){const S=v,M=c(!0),u=c(""),o=c(""),w=c(""),I=c(""),N=c(""),x=()=>{M.value=!1,S("close")},P=()=>{new window.daum.Postcode({oncomplete:function(f){let l=f.userSelectedType==="R"?f.roadAddress:f.jibunAddress;I.value=l}}).open()},V=()=>{if(!u.value||!o.value||!w.value||!I.value||!N.value){alert("모든 필드를 입력해주세요.");return}const f=`${I.value} ${N.value}`;S("addressRegistered",{addressName:u.value,recipientName:o.value,phoneNumber:w.value,fullAddress:f}),x()};return(f,l)=>M.value?(r(),i("div",re,[e("div",ie,[e("div",{class:"delete-button"},[e("button",{type:"button",class:"x-button",onClick:x},"X")]),l[9]||(l[9]=e("div",{class:"info-header"},[e("span",{class:"info-title"},"신규 배송지 등록")],-1)),e("div",ue,[l[5]||(l[5]=e("span",null,"배송지명",-1)),y(e("input",{type:"text","onUpdate:modelValue":l[0]||(l[0]=h=>u.value=h),class:"span-text",placeholder:"배송지명 입력"},null,512),[[k,u.value]])]),e("div",ce,[l[6]||(l[6]=e("span",null,"받는 사람",-1)),y(e("input",{type:"text","onUpdate:modelValue":l[1]||(l[1]=h=>o.value=h),class:"span-text",placeholder:"받는 사람 입력"},null,512),[[k,o.value]])]),e("div",pe,[l[7]||(l[7]=e("span",null,"휴대폰 번호",-1)),y(e("input",{type:"text","onUpdate:modelValue":l[2]||(l[2]=h=>w.value=h),class:"span-text",placeholder:"휴대폰 번호 입력"},null,512),[[k,w.value]])]),e("div",{class:"search-address"},[l[8]||(l[8]=e("div",{class:"label-address"},[e("span",null,"주소")],-1)),e("div",{class:"button-zipcode",onClick:P},"우편번호 찾기 ")]),e("div",ve,[y(e("input",{type:"text","onUpdate:modelValue":l[3]||(l[3]=h=>I.value=h),class:"span-text",placeholder:"우편번호 입력"},null,512),[[k,I.value]]),y(e("input",{type:"text","onUpdate:modelValue":l[4]||(l[4]=h=>N.value=h),class:"span-text",placeholder:"상세 주소 입력"},null,512),[[k,N.value]])]),e("div",{class:"button-block"},[e("div",{class:"button-register",onClick:V},"등록하기")])])])):A("",!0)}},ye=G(me,[["__scopeId","data-v-a9fa43c0"]]),he={class:"order-container"},fe={class:"recipient-info-section"},_e={class:"info-table"},be={class:"info-row"},Ae={class:"info-row"},ke={class:"info-row"},Ie={class:"info-row"},De={class:"info-row"},ge={class:"info-row2"},we={class:"info-data"},Ne={class:"memo-list"},xe=["value"],Pe={class:"memo-text"},Me={class:"product-info-section"},Ue={key:0},Ce=["src"],Se={class:"item-description2"},Ve={key:0,class:"brand-name"},Re={key:1,class:"product-name"},Ee={key:2,class:"product-name"},$e={key:0,class:"product-variant"},qe={key:1,class:"product-variant"},Te={class:"rental-period"},Be={class:"price"},Fe={class:"item-price"},Qe={key:0,class:"adjusted-price"},Xe={key:1},Ye={key:0},je={class:"item-description"},Oe=["src"],ze={class:"item-description2"},Ge={class:"brand-name"},He={class:"product-name"},Le={class:"product-variant"},We={class:"price"},Je={class:"item-price"},Ze={class:"adjusted-price"},Ke={key:1},et={class:"item-description"},tt=["src"],st={class:"product-name"},at={class:"product-variant"},ot={class:"product-variant2"},lt={class:"price"},nt={class:"item-price"},dt={class:"adjusted-price"},rt={class:"payment-frame"},it={class:"payment-method-list"},ut={class:"payment-method-item"},ct={class:"summary-row"},pt={class:"summary-value"},vt={class:"total-payment-section"},mt={class:"agreement-list"},yt=["onUpdate:modelValue"],ht={class:"agreement-text"},ft={key:0,class:"modal"},_t={class:"modal-content"},bt={class:"modal-actions"},Dt={__name:"OrderView",setup(Y){var Q;const v=H(),M=(Q=L().user)==null?void 0:Q.userId,u=ae(),o=c(null),w=K(),I=async s=>{let t;s.type==="codi"?t=`lookkit/codi/0${s.itemId}/${s.itemId}_thumbnail.webp`:s.type==="product"&&(t=`lookkit/products/0${s.itemId}/${s.itemId}_thumbnail.webp`),console.log("이미지 경로 확인:",t);try{const a=oe(le,t),p=await ne(a);s.thumbnailUrl=p,s===o.value&&(o.value.thumbnailUrl=p)}catch(a){console.error(`이미지 가져오기 실패: ${t}`,a),s.thumbnailUrl="/images/placeholder.png"}};q(async()=>{const s=w.query;s.itemId&&(o.value={itemId:s.itemId,itemName:s.itemName,brandName:s.brandName,quantity:parseInt(s.quantity,10)||1,startDate:s.startDate,endDate:s.endDate,price:parseInt(s.price,10),totalPrice:parseInt(s.totalPrice,10),type:s.itemType||"product"},await I(o.value));for(const t of u.selectedItems)await I(t)});const N=s=>{if(s.type==="product")return s.totalPrice*(s.quantity||1);if(s.type==="codi"){const t=x(s.startDate,s.endDate),a=s.totalPrice,_=(t>3?t-3:0)*1e4;return a+_}return s.totalPrice},x=(s,t)=>{if(!s||!t)return 0;const a=new Date(s),_=new Date(t)-a,g=Math.ceil(_/(1e3*60*60*24));return g>0?g:0};c(""),c(""),c(""),c("");const P=c("선택 안 함"),V=["선택 안 함","부재 시 경비실에 맡겨주세요","부재 시 집 앞에 놔주세요","부재 시 핸드폰으로 연락 바랍니다","배송 전 연락 바랍니다"],f=c(""),l=c([{text:"주문상품정보 및 서비스 이용약관에 동의",checked:!1},{text:"구매조건 확인 및 결제 진행 동의(필수)",checked:!1},{text:"개인정보 제 3자 제공 동의(필수)",checked:!1},{text:"위 주문 내용을 확인하였으며, 결제에 모두 동의합니다",checked:!1}]);q(async()=>{await W(),console.log("Selected items in orderStore after mount:",u.selectedItems)}),J(()=>{99/u.clearSelectedItems(),localStorage.removeItem("orderStore")});const h=T(()=>o.value?o.value.quantity||1:u.selectedItems.reduce((s,t)=>s+(t.quantity||1),0)),R=T(()=>{if(o.value&&o.value.type==="codi"&&o.value.startDate&&o.value.endDate){const s=new Date(o.value.startDate),t=new Date(o.value.endDate);return Math.ceil((t-s)/(1e3*60*60*24))}return u.selectedItems.reduce((s,t)=>{if(t.type==="codi"&&t.startDate&&t.endDate){const a=new Date(t.startDate),p=new Date(t.endDate);return s+Math.ceil((p-a)/(1e3*60*60*24))}return s},0)}),U=T(()=>{if(o.value){if(o.value.type==="product")return o.value.quantity*o.value.price;if(o.value.type==="codi"){const t=(R.value>3?R.value-3:0)*1e4;return o.value.price+t}}return u.totalFinalPrice||0}),D=s=>s?s.toLocaleString():"0";q(()=>{const s=document.createElement("script");s.src="https://cdn.iamport.kr/js/iamport.payment-1.2.0.js",s.async=!0,s.onload=()=>{console.log("Iamport script loaded successfully");const t=window.IMP;t&&t.init("imp40354073")},document.body.appendChild(s)});const F=se(),j=()=>{if(!f.value){alert("결제 수단을 선택해주세요.");return}if(l.value.some(g=>!g.checked)){alert("모든 필수 동의 항목에 체크해주세요.");return}if(!m.value){alert("배송지를 등록해주세요.");return}const s=window.IMP;s.init("imp40354073");const t=u.selectedItems.length>0?u.selectedItems[0].itemName:"주문 상품",a=m.value.recipientName,p=m.value.phoneNumber,_=m.value.fullAddress;s.request_pay({pg:"kcp",pay_method:"card",merchant_uid:"merchant_"+new Date().getTime(),name:t,amount:U.value,buyer_name:a,buyer_tel:p,buyer_addr:_},function(g){if(g.success){v.showModal("결제 완료","결제가 완료되었습니다.","","확인",()=>{v.closeModal()});let $=[];u.selectedItems.length>0&&($=u.selectedItems.map(d=>({productId:d.type==="product"?d.itemId:null,codiId:d.type==="codi"?d.itemId:null,quantity:d.type==="product"?d.quantity:1,rentalStartDate:d.type==="codi"?d.startDate:null,rentalEndDate:d.type==="codi"?d.endDate:null,productPrice:d.totalPrice}))),o.value&&$.push({productId:o.value.type==="product"?o.value.itemId:null,codiId:o.value.type==="codi"?o.value.itemId:null,quantity:o.value.type==="product"?o.value.quantity:1,rentalStartDate:o.value.type==="codi"?o.value.startDate:null,rentalEndDate:o.value.type==="codi"?o.value.endDate:null,productPrice:o.value.totalPrice});const z={userId:M,totalAmount:U.value,orderAddress:_,orderAddressee:a,orderPhone:p,orderComment:P.value,orderStatus:"결제완료",orderDetails:$};fetch("http://localhost:8081/api/order/complete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(z)}).then(d=>d.json()).then(d=>{if(!d){alert("주문 ID를 받지 못했습니다. 문제가 발생했습니다.");return}console.log("주문 완료 페이지로 이동, orderId:",d),F?F.push({path:"/order/orderComplete",query:{orderId:d}}):console.error("Router 객체가 정의되지 않았습니다.")}).catch(d=>{console.error("결제 실패 또는 서버 문제:",d),alert("결제를 완료하는 데 실패했습니다.")})}else v.showModal("결제 실패",`결제에 실패했습니다. 실패사유: ${g.error_msg}`,"","확인",v.closeModal)})},E=c(!1),m=c({addressName:"",recipientName:"",phoneNumber:"",fullAddress:""}),O=s=>{m.value=s};return(s,t)=>(r(),i(C,null,[e("div",he,[t[23]||(t[23]=e("div",{class:"order-title"},[e("h2",null,"결제/주문")],-1)),e("section",fe,[t[16]||(t[16]=e("header",{class:"section-header"},[e("h2",{class:"section-title"},"받는 분 정보")],-1)),e("div",_e,[e("div",be,[t[10]||(t[10]=e("span",{class:"label-title"},"배송지 정보",-1)),e("button",{class:"link-text",onClick:t[0]||(t[0]=a=>E.value=!0)},"배송지 등록하기"),E.value?(r(),Z(ye,{key:0,onClose:t[1]||(t[1]=a=>E.value=!1),onAddressRegistered:O})):A("",!0)]),e("div",Ae,[t[11]||(t[11]=e("div",{class:"info-label"},"배송지명",-1)),y(e("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=a=>m.value.addressName=a),class:"input-field",readonly:""},null,512),[[k,m.value.addressName]])]),e("div",ke,[t[12]||(t[12]=e("div",{class:"info-label"},"받는 사람",-1)),y(e("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=a=>m.value.recipientName=a),class:"input-field",readonly:""},null,512),[[k,m.value.recipientName]])]),e("div",Ie,[t[13]||(t[13]=e("div",{class:"info-label"},"휴대폰 번호",-1)),y(e("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=a=>m.value.phoneNumber=a),class:"input-field",readonly:""},null,512),[[k,m.value.phoneNumber]])]),e("div",De,[t[14]||(t[14]=e("div",{class:"info-label"},"주소",-1)),y(e("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=a=>m.value.fullAddress=a),class:"input-field",readonly:""},null,512),[[k,m.value.fullAddress]])])]),e("div",ge,[t[15]||(t[15]=e("div",{class:"info-label"},"배송 메모",-1)),e("div",we,[e("div",Ne,[(r(),i(C,null,B(V,(a,p)=>e("label",{class:"memo-item",key:p},[y(e("input",{type:"radio",name:"memo-option",class:"memo-checkbox",value:a,"onUpdate:modelValue":t[6]||(t[6]=_=>P.value=_)},null,8,xe),[[X,P.value]]),e("span",Pe,n(a),1)])),64))])])])]),e("section",Me,[t[17]||(t[17]=e("header",{class:"section-header"},[e("h2",{class:"section-title"},"상품 정보")],-1)),b(u).selectedItems.length>0?(r(),i("div",Ue,[(r(!0),i(C,null,B(b(u).selectedItems,a=>(r(),i("div",{key:a.itemId,class:"item-description"},[e("img",{class:"item-thumbnail",src:a.thumbnailUrl||"/images/placeholder.png",alt:"썸네일"},null,8,Ce),e("div",Se,[a.type==="product"&&a.brandName?(r(),i("div",Ve,n(a.brandName),1)):A("",!0),a.type==="product"?(r(),i("div",Re,n(a.itemName),1)):a.type==="codi"?(r(),i("div",Ee,n(a.itemName),1)):A("",!0)]),a.type==="product"?(r(),i("div",$e,n(a.quantity)+"개 ",1)):a.type==="codi"?(r(),i("div",qe,[ee(" 대여일 "+n(a.startDate)+" ~ 반납일 "+n(a.endDate)+" ",1),e("div",Te,"대여기간 "+n(x(a.startDate,a.endDate))+"일",1)])):A("",!0),e("div",Be,[e("div",Fe,n(D(a.totalPrice))+"원",1),a.type==="product"||a.type==="codi"?(r(),i("div",Qe,n(D(N(a)))+"원 ",1)):A("",!0)])]))),128))])):o.value?(r(),i("div",Xe,[o.value.type==="product"?(r(),i("div",Ye,[e("div",je,[e("img",{class:"item-thumbnail",src:o.value.thumbnailUrl||"/images/placeholder.png",alt:"썸네일"},null,8,Oe),e("div",ze,[e("div",Ge,n(o.value.brandName),1),e("div",He,n(o.value.itemName),1)]),e("div",Le,n(o.value.quantity)+"개",1),e("div",We,[e("div",Je,n(D(o.value.price))+"원",1),e("div",Ze,n(D(o.value.totalPrice))+"원",1)])])])):o.value.type==="codi"?(r(),i("div",Ke,[e("div",et,[e("img",{class:"item-thumbnail",src:o.value.thumbnailUrl||"/images/placeholder.png",alt:"썸네일"},null,8,tt),e("div",st,n(o.value.itemName),1),e("div",at,"대여일 "+n(o.value.startDate)+" ~반납일 "+n(o.value.endDate),1),e("div",ot,"대여기간 "+n(R.value)+"일",1),e("div",lt,[e("div",nt,n(D(o.value.price))+"원",1),e("div",dt,n(D(o.value.totalPrice))+"원",1)])])])):A("",!0)])):A("",!0)]),e("section",rt,[t[21]||(t[21]=e("header",{class:"section-header2"},[e("h2",{class:"section-title"},"결제수단 선택")],-1)),e("div",it,[e("label",ut,[y(e("input",{type:"radio",name:"payment-method",value:"card","onUpdate:modelValue":t[7]||(t[7]=a=>f.value=a)},null,512),[[X,f.value]]),t[18]||(t[18]=e("img",{src:de,alt:"Credit/Debit Card",class:"method-icon"},null,-1)),t[19]||(t[19]=e("span",{class:"method-title"},"신용/체크카드",-1))])]),t[22]||(t[22]=e("header",{class:"section-header2"},[e("h2",{class:"section-title"},"최종 결제금액")],-1)),e("div",ct,[t[20]||(t[20]=e("span",{class:"summary-title"},"최종 결제금액",-1)),e("span",pt,n(D(U.value))+"원",1)])]),e("section",vt,[e("div",mt,[(r(!0),i(C,null,B(l.value,(a,p)=>(r(),i("label",{class:"agreement-item",key:p},[y(e("input",{type:"checkbox","onUpdate:modelValue":_=>l.value[p].checked=_},null,8,yt),[[te,l.value[p].checked]]),e("span",ht,n(a.text),1)]))),128))])]),e("button",{class:"pay-button",onClick:j}," 총 "+n(h.value)+"개 / "+n(D(U.value))+"원 결제하기 ",1)]),b(v).isModalVisible?(r(),i("div",ft,[e("div",_t,[e("h3",null,n(b(v).modalActionMessage),1),e("p",null,n(b(v).questionMessage),1),e("div",bt,[e("button",{onClick:t[8]||(t[8]=(...a)=>b(v).confirmCallback&&b(v).confirmCallback(...a))},"확인"),e("button",{onClick:t[9]||(t[9]=(...a)=>b(v).closeModal&&b(v).closeModal(...a))},"취소")])])])):A("",!0)],64))}};export{Dt as default};
